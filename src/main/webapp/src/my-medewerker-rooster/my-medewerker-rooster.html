<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-time-input/paper-time-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-column.html">




<dom-module id="my-medewerker-rooster">
    <template>
        <style>
            :host {
                display: block;
                padding: 10px 20px;
            }
            .my-title {
                font-size: 20px;
                color: #1a9fd9;
                font-weight: bold;
                border-bottom: 1px solid #E62F2B;
                padding-bottom: 2px;
            }
        </style>
        <table>
            <tr>
                <td>
                    <input type="week" id="dateMrooster" value="{{date}}" on-change="rooster_ophalen"/>
                </td>
            </tr>
        </table>
        <div class="my-title">Week Overzicht medewerkers {{date}}</div>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_maandag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center"> Maandag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>
            </vaadin-grid-column-group>

        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_dinsdag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center"> Dinsdag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>
            </vaadin-grid-column-group>

        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_woensdag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center"> Woensdag</template>
                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>
            </vaadin-grid-column-group>

        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_donderdag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center">Donderdag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>

            </vaadin-grid-column-group>
        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_vrijdag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center">Vrijdag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>
            </vaadin-grid-column-group>

        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_zaterdag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center">Zaterdag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>

            </vaadin-grid-column-group>
        </vaadin-grid>
        <br>
        <vaadin-grid aria-label="Basic Binding Example" style="height:100%;" items="[[rooster_zondag]]">
            <vaadin-grid-column-group>
                <template class="header" style="text-align: center">Zondag</template>

                <vaadin-grid-column>
                    <template class="header">Naam</template>
                    <template>
                        <paper-button id=[[item.naam]] class="my-button" on-click="_button_clicked">[[item.naam]]</paper-button>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Begintijd</template>
                    <template>[[item.begintijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Eindtijd</template>
                    <template>[[item.eindtijd]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Pauze</template>
                    <template>[[item.pauze]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header">Ziek</template>
                    <template>[[item.ziek]]</template>
                </vaadin-grid-column>

            </vaadin-grid-column-group>
        </vaadin-grid>

        <iron-ajax
                id="ajax_rooster_maandag_ophalen"
                method="POST"
                url="/services/rooster/maandag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_maandag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_dinsdag_ophalen"
                method="POST"
                url="/services/rooster/dinsdag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_dinsdag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_woensdag_ophalen"
                method="POST"
                url="/services/rooster/woensdag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_woensdag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_donderdag_ophalen"
                method="POST"
                url="/services/rooster/donderdag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_donderdag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_vrijdag_ophalen"
                method="POST"
                url="/services/rooster/vrijdag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_vrijdag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_zaterdag_ophalen"
                method="POST"
                url="/services/rooster/zaterdag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_zaterdag}}">
        </iron-ajax>
        <iron-ajax
                id="ajax_rooster_zondag_ophalen"
                method="POST"
                url="/services/rooster/zondag/medewerkers/ophalen"
                handle-as="json"
                last-response="{{rooster_zondag}}">
        </iron-ajax>


    </template>
    <script>
        Polymer({
            is: 'my-medewerker-rooster',
            properties:{
                c_visible: {
                    type: Boolean, /* true when element is the active visible item */
                    value: false,
                    observer: '_initializing', /* wordt ook aangeroepen bijwisseling van true naar false.
                     regel in de functie dat er niets gebeurd
                     als c_visible false is */
                },
                date:String,
                medewerkername:{
                    type: String,
                    notify:true
                },
                rooster_maandag:Object,
                rooster_dinsdag:Object,
                rooster_woensdag:Object,
                rooster_donderdag:Object,
                rooster_vrijdag:Object,
                rooster_zaterdag:Object,
                rooster_zondag:Object,
            },
            _initializing: function() {
                if (this.c_visible) {
                    this.getDateToday();
                    this.rooster_ophalen();
                }
            },
            _roosters_maandag_ophalen_request_handler: function () {
                this.$['ajax_rooster_maandag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_maandag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_maandag_ophalen'].generateRequest();
            },
            _roosters_dinsdag_ophalen_request_handler: function () {
                this.$['ajax_rooster_dinsdag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_dinsdag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_dinsdag_ophalen'].generateRequest();
            },
            _roosters_woensdag_ophalen_request_handler: function () {
                this.$['ajax_rooster_woensdag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_woensdag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_woensdag_ophalen'].generateRequest();
            },
            _roosters_donderdag_ophalen_request_handler: function () {
                this.$['ajax_rooster_donderdag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_donderdag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_donderdag_ophalen'].generateRequest();
            },
            _roosters_vrijdag_ophalen_request_handler: function () {
                this.$['ajax_rooster_vrijdag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_vrijdag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_vrijdag_ophalen'].generateRequest();
            },
            _roosters_zaterdag_ophalen_request_handler: function () {
                this.$['ajax_rooster_zaterdag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_zaterdag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_zaterdag_ophalen'].generateRequest();
            },
            _roosters_zondag_ophalen_request_handler: function () {
                this.$['ajax_rooster_zondag_ophalen'].contentType = "application/json";
                this.$['ajax_rooster_zondag_ophalen'].body = {
                    "date": this.date
                };
                this.$['ajax_rooster_zondag_ophalen'].generateRequest();
            },

            rooster_ophalen : function () {
                var datum = document.querySelector("#dateMrooster").value;
                this.date = datum ;
                this._roosters_maandag_ophalen_request_handler();
                this._roosters_dinsdag_ophalen_request_handler();
                this._roosters_woensdag_ophalen_request_handler();
                this._roosters_donderdag_ophalen_request_handler();
                this._roosters_vrijdag_ophalen_request_handler();
                this._roosters_zaterdag_ophalen_request_handler();
                this._roosters_zondag_ophalen_request_handler();
            },
            getDateToday: function () {
                d = new Date();
                d.setHours(0, 0, 0, 0);
                // Set to nearest Thursday: current date + 4 - current day number
                // Make Sunday's day number 7
                d.setDate(d.getDate() + 4 - (d.getDay() || 7));
                // Get first day of year
                var yearStart = new Date(d.getFullYear(), 0, 1);
                // Calculate full weeks to nearest Thursday
                var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1) / 7);
                // Return array of year and week number
                this.date = d.getFullYear()+'-W'+weekNo;
                console.log(d.getFullYear()+"-W"+weekNo);
            },
            _button_clicked: function (evt) {
                var lButton = evt.currentTarget;
                var id = lButton.id;
                this.medewerkername = id;
                this.go_medewerker_stats();

            },
            go_medewerker_stats: function() {
                var lApp = document.querySelector('my-app');  //het polymer element <my-app>
                var lAppRouter = lApp.$.approuter;            // het html-element <app-route> met id=approuter
                lAppRouter.data={page: "medewerker_stats"};                   // vul het data attribute met de homepage url
                // door de two way binding in <app-route> en <app-location>// zal ook de url echt wijzigen
            }
        });
    </script>
</dom-module>
